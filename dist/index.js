parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"39eF":[function(require,module,exports) {
"use strict";function e(e,...r){let t,n=void 0,s=e;for(;void 0!==(t=r.shift());)if(s instanceof Object&&!(s instanceof Array))n=s[t],s=s[t];else{if(!(s instanceof Array))return;{const e=parseInt(t);if(isNaN(e))return;n=s[e],s=s[e]}}return n}Object.defineProperty(exports,"__esModule",{value:!0}),exports.safeProp=e;
},{}],"Y/Oq":[function(require,module,exports) {
"use strict";function t(t,...x){let e=x.shift(),n=t;for(;void 0!==e;){if(!(e in n)||void 0===n[e])throw`Property: ${e} is not in the object`;n=n[e=x.shift()]}}function x(t){if(-1===t.indexOf("/"))throw"The input hash_url should be in this format: `xx/xx/xx/xx/xx/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`";const x="/"===t[0]?1:0,e="/"===t.slice(-1)?-1:t.length;return t.slice(x,e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.checkProps=t,exports.filterHashUrl=x,exports.OpStep=void 0;class e{constructor(t,...x){this.main_fn=t,this.next_nodes=x}run(...t){const x=this.main_fn.apply(this,t);return"boolean"==typeof x?x?this.next_nodes[0]&&this.next_nodes[0].run():this.next_nodes[1]&&this.next_nodes[1].run():x instanceof Promise?x.then(t=>this.next_nodes[0]&&this.next_nodes[0].run(t)).catch(t=>{throw`OpStep error caught: ${t}`}):void 0}}exports.OpStep=e;
},{}],"cg5q":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Mixed=exports.Posts=exports.Gets=void 0;var e=a(require("@babel/runtime/helpers/defineProperty")),t=require("../types"),r=require("../util");function a(e){return e&&e.__esModule?e:{default:e}}class o{constructor(e){this.fetch=e}custom(e){return this.fetch(e)}head(e){return this.fetch(`/chains/main/blocks/head/${e||""}`)}hash(){return this.head("hash")}header(){return this.head("header")}protocol(){return this.header().then(e=>(0,t.safeProp)(e,"protocol"))}predecessor(){return this.header().then(e=>(0,t.safeProp)(e,"predecessor"))}balance(e){return this.fetch(`/chains/main/blocks/head/context/contracts/${e}/balance`)}contract(e){return this.fetch(`/chains/main/blocks/head/context/contracts/${e}`)}contract_bytes(e,t){const a=(0,r.filterHashUrl)(e);return this.fetch(`/chains/main/blocks/head/context/raw/bytes/contracts/index/originated/${a}${t||""}`)}storage_bytes(e){return this.contract_bytes(e,"/data/storage")}big_map_bytes(e){return this.contract_bytes(e,"/big_map")}manager_key(e){return this.fetch(`/chains/main/blocks/head/context/contracts/${e}/manager_key`)}counter(e){return this.fetch(`/chains/main/blocks/head/context/contracts/${e}/counter`)}}exports.Gets=o;class s{constructor(e){this.submit=e}pack_data(e,r){const a={data:e,type:r,gas:"400000"};return this.submit("/chains/main/blocks/head/helpers/scripts/pack_data",a).then(e=>(0,t.safeProp)(e,"packed"))}forge_operation(e,t){const r={branch:e,contents:t};return this.submit("/chains/main/blocks/head/helpers/forge/operations",r)}preapply_operation(e,t,r,a){const o={branch:e,contents:t,protocol:r,signature:a};return this.submit("/chains/main/blocks/head/helpers/preapply/operations",[o])}inject_operation(e){return this.submit("/injection/operation",e)}}exports.Posts=s;class n{constructor(e,t){this.fetch=e,this.submit=t}async makeOperationBytes(e,r){const a=[],o=await this.fetch.counter(e.source),s=await this.fetch.manager_key(e.source);if("string"!=typeof o)throw"Invalid counter";let i=parseInt(o)+1+"";if(!(0,t.safeProp)(s,"key")){const t=n.params.reveal(e.source,e.public_key,i);r.length&&"reveal"===r[0].kind?a.push(Object.assign({},t,r.shift())):a.push(t),i=parseInt(i)+1+""}const c=(0,t.safeProp)(s,"manager");if("string"!=typeof c)throw"Invalid manager public key hash";r.forEach(t=>{const r={reveal:null,origination:Object.assign({},n.params.origination(e.source,c,i),t),transaction:Object.assign({},n.params.transaction(e.source,t.destination||"",i),t),delegation:Object.assign({},n.params.delegation(e.source,t.baker||"",i))}[t.kind];if(!r)throw`Invalid t(${t.kind}) in makeOperationBytes`;a.push(r),i=parseInt(i)+1+""});const h=await this.fetch.hash();if("string"!=typeof h)throw`Error type for head_hash result: ${h.toString()}`;const l=await this.submit.forge_operation(h,a);return{protocol:await this.fetch.protocol(),operation_hex:l,branch:h,contents:a}}async makeOriginationBytes(e,t){return this.makeOperationBytes({source:e.source,public_key:e.public_key},[Object.assign({kind:"origination"},t)])}async makeTransactionBytes(e,t){return this.makeOperationBytes({source:e.source,public_key:e.public_key},[Object.assign({kind:"transaction"},t)])}async makeMinFeeOperation(e,t,r,a){const o=e.crypto.getKeyFromSecretKey(r);a.forEach(e=>{delete e.fee,delete e.gas_limit,delete e.storage_limit});const s=await this.makeOperationBytes({source:t||o.address,public_key:o.getPublicKey()},a),n=s.contents,i=e.localop.forgeOperation(s.contents,s.branch);if(i!==s.operation_hex)throw`Inconsistent forged bytes:\nLocal(${i})\nRemote(${s.operation_hex})`;s.signature=e.crypto.signOperation(s.operation_hex,r);const c=await this.submit.preapply_operation(s.branch,s.contents,s.protocol,s.signature);if(!(c instanceof Array))throw`Invalid preapplyed result: ${c}`;let h=0;c[0].contents.forEach((e,t)=>{let r=0,a=0;const o=e.metadata.operation_result,s=e.metadata.internal_operation_results;if(s&&s.forEach(e=>{if(e.result.errors)throw`Internal operation errors:${JSON.stringify(e.result.errors,null,2)}`;r+=parseInt(e.result.consumed_gas),e.result.paid_storage_size_diff&&(a+=parseInt(e.result.paid_storage_size_diff)),e.result.originated_contracts&&(a+=257*e.result.originated_contracts.length)}),o.errors)throw`Operation errors:${JSON.stringify(o.errors,null,2)}`;r+=parseInt(o.consumed_gas),o.paid_storage_size_diff&&(a+=parseInt(o.paid_storage_size_diff)),o.originated_contracts&&(a+=257*o.originated_contracts.length),n[t].gas_limit=r+"",n[t].storage_limit=a+"",n[t].fee="0",h+=parseInt(r)});const l=s.operation_hex+e.codec.toHex(e.codec.bs58checkDecode(s.signature)),p=Math.ceil(100+l.length/2+.1*h);let u=p;if(n.forEach(e=>{const t=u<=4e5?u:4e5;e.fee=t+"",u-=t}),u)throw`Still need ${u} fee to run the operation`;const d=await this.makeOperationBytes({source:o.address,public_key:o.getPublicKey()},n);if(e.localop.forgeOperation(d.contents,d.branch)!==d.operation_hex)throw`Inconsistent final forged bytes:\nLocal(${i})\nRemote(${d.operation_hex})`;d.signature=e.crypto.signOperation(d.operation_hex,r);const g=d.operation_hex+e.codec.toHex(e.codec.bs58checkDecode(d.signature)),f=await this.submit.preapply_operation(d.branch,d.contents,d.protocol,d.signature);if(!(f instanceof Array))throw`Invalid final preapplyed result: ${f}`;const _=[];return f[0].contents.forEach((e,t)=>{const r=e.metadata.operation_result,a=e.metadata.internal_operation_results;if(a&&a.forEach(e=>{if(e.result.errors)throw`Final internal operation errors:${JSON.stringify(e.result.errors,null,2)}`;e.result.originated_contracts&&_.push(e.result.originated_contracts)}),r.errors)throw`Final operation errors:${JSON.stringify(r.errors,null,2)}`;r.originated_contracts&&_.push(r.originated_contracts)}),{fee:p,originated_contracts:_,branch:d.branch,operation_contents:d.contents,operation_with_sig:g}}}exports.Mixed=n,(0,e.default)(n,"params",{reveal:(e,t,r)=>({kind:"reveal",source:e,fee:"1300",gas_limit:"10000",storage_limit:"0",public_key:t,counter:r}),transaction:(e,t,r)=>({kind:"transaction",source:e,fee:"400000",gas_limit:"400000",storage_limit:"60000",amount:"0",counter:r,destination:t}),origination:(e,t,r)=>({kind:"origination",source:e,fee:"400000",counter:r,gas_limit:"400000",storage_limit:"60000",managerPubkey:t,balance:"0"}),delegation:(e,t,r)=>({counter:r,delegate:t,fee:"1420",gas_limit:"10000",kind:"delegation",source:e,storage_limit:"0"})});var i={Gets:o,Posts:s,Mixed:n};exports.default=i;
},{"../types":"39eF","../util":"Y/Oq"}],"ii4M":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.External=void 0;class t{constructor(t,e){this.fetch=t,this.net_type="alphanet"===e?e:"mainnet"}domain(){if("mainnet"===this.net_type)return"https://api1.tzscan.io/v3";if("alphanet"===this.net_type)return"https://api.alphanet.tzscan.io/v3";throw"The net type can only be mainnet or alphanet"}async originated_contracts(t,e=!0){const n=this.domain()+`/operations/${t}?type=Origination`,a=await this.fetch(n),i=[];if(!(a instanceof Array))throw"Operations is invalid";return a.forEach(t=>{t.type.operations.forEach(t=>{t.spendable===e&&i.push(t.tz1.tz)})}),i}}exports.External=t;
},{}],"Focm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.TezBridgeNetwork=void 0;var t=s(require("./PsddFKi3/api")),e=require("./external");function s(t){return t&&t.__esModule?t:{default:t}}const o=(()=>{if("browser"===process.env.NODE_ENV)return(t,e,s)=>new Promise((o,r)=>{const i=new XMLHttpRequest;i.addEventListener("load",t=>{200===i.status?o(JSON.parse(i.responseText)):r(i.responseText)}),i.addEventListener("error",r),i.addEventListener("abort",r),i.open(s,t),"POST"===s&&i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify(e))});{const t=require("https"),e=require("url");return(s,o,r)=>new Promise((i,n)=>{const h=e.parse(s),a={hostname:h.hostname,port:h.port,path:h.path,method:r,headers:s.indexOf("tzscan.io/v3")>-1?{}:{"Content-Type":"application/json"}},d=t.request(a,t=>{let e="";t.on("data",t=>{e+=t.toString()}),t.on("end",()=>{try{i(JSON.parse(e))}catch(t){console.log("[31m%s[0m","RPC result JSON.parse error: ",e)}})});d.on("error",t=>{n(t)}),"POST"===r&&d.write(JSON.stringify(o)),d.end()})}})(),r={PsddFKi3:t.default};class i{constructor(t){if(!t.host)throw"Please set the host parameter";this.host=t.host,this.RPCFn=o,this.net_type=this.host.indexOf("alphanet")>-1?"alphanet":"mainnet";const s=t.protocol||"PsddFKi3";if(!(s in r))throw`Protocol:${s} doesn't exist in protocols`;this.fetch=new r[s].Gets((t,e)=>this.get.call(this,t,e)),this.submit=new r[s].Posts((t,e)=>this.post.call(this,t,e)),this.mixed=new r[s].Mixed(this.fetch,this.submit),this.external=new e.External((t,e)=>this.RPCFn(t,e,"GET"),this.net_type)}switchProtocol(t){if(!(t in r))throw`Protocol:${t} doesn't exist in protocols`;this.fetch=new r[t].Gets((t,e)=>this.get.call(this,t,e)),this.submit=new r[t].Posts((t,e)=>this.post.call(this,t,e)),this.mixed=new r[t].Mixed(this.fetch,this.submit)}get(t,e){return this.RPCFn(this.host+t,e,"GET")}post(t,e){return this.RPCFn(this.host+t,e,"POST")}}exports.TezBridgeNetwork=i;var n=i;exports.default=n;
},{"./PsddFKi3/api":"cg5q","./external":"ii4M"}]},{},["Focm"], null)
//# sourceMappingURL=/index.js.map