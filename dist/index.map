{"version":3,"sources":["types.js","api.js","index.js"],"names":["safeProp","x","props","result","prop","undefined","curr","shift","Object","Array","prop_index","parseInt","isNaN","gets","fetch","mapping","custom","path","head","sub_key","hash","header","protocol","then","balance","address","contract","manager_key","TezBridgeNetwork","params","host","RPCFn","bindApi","gets_closure","url","data","get","call","keys","forEach","key","args","apply","method","Promise","resolve","reject","req","XMLHttpRequest","addEventListener","pe","status","JSON","parse","responseText","open","setRequestHeader","send","stringify"],"mappings":"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","file":"index.map","sourceRoot":"../src","sourcesContent":["// @flow\n\nexport type TezJSON =\n| number\n| string\n| boolean\n| void\n| {[string]: TezJSON}\n| Array<TezJSON>\n\nexport function safeProp(x : TezJSON, ...props : Array<string | number>) {\n  let result = undefined\n\n  let prop\n  let curr = x\n  while (true) {\n    prop = props.shift()\n    if (prop === undefined)\n      break\n\n    if (curr instanceof Object && !(curr instanceof Array)) {\n      result = curr[prop]\n      curr = curr[prop]\n    } else if (curr instanceof Array) {\n      const prop_index = parseInt(prop)\n      if (isNaN(prop_index))\n        return undefined\n\n      result = curr[prop_index]\n      curr = curr[prop_index]\n    } else {\n      return undefined\n    }\n  }\n\n  return result\n}\n\nexport type RPCFunc = (url: string, data?: TezJSON, method: 'POST' | 'GET') => Promise<TezJSON>\nexport type GetRPCFunc = (url: string, data?: TezJSON) => Promise<TezJSON>\nexport type PostRPCFunc = (url: string, data: TezJSON) => Promise<TezJSON>\n\nexport type ApiGetsFunc = GetRPCFunc => {[string]: any => Promise<TezJSON>}","// @flow\n\nimport type { GetRPCFunc, TezJSON, ApiGetsFunc } from './types'\nimport { safeProp } from './types'\n\nexport const gets : ApiGetsFunc = (fetch : GetRPCFunc) => {\n  const mapping : {[string]: any => Promise<TezJSON>} = {\n    custom(path : string) {\n      return fetch(path)\n    },\n    head(sub_key? : string) {\n      return fetch(`/chains/main/blocks/head/${sub_key || ''}`)\n    },\n    hash() {\n      return mapping.head('hash')\n    },\n    header() {\n      return mapping.head('header')\n    },\n    protocol() {\n      return mapping.header().then(x => safeProp(x, 'protocol'))\n    },\n    balance(address : string) {\n      return fetch(`/chains/main/blocks/head/context/delegates/${address}/balance`)\n    },\n    contract(address : string) {\n      return fetch(`/chains/main/blocks/head/context/contracts/${address}`)\n    },\n    manager_key(address : string) {\n      return fetch(`/chains/main/blocks/head/context/contracts/${address}/manager_key`).then(x => safeProp(x, 'manager'))\n    }\n  }\n\n  return mapping\n}","// @flow\n\nimport type { RPCFunc, TezJSON, ApiGetsFunc } from './types'\nimport { gets } from './api'\n\nexport class TezBridgeNetwork {\n  host: string\n  RPCFn: RPCFunc | null\n  fetch: {[string]: any => Promise<TezJSON>}\n\n  static RPCFn : RPCFunc = (url, data, method) => {\n    return new Promise<TezJSON>((resolve, reject) => {\n      const req = new XMLHttpRequest()\n      req.addEventListener('load', (pe: ProgressEvent) => {\n        if (req.status === 200)\n          resolve(JSON.parse(req.responseText))\n        else\n          reject(req.responseText)\n      })\n      req.addEventListener('error', reject)\n      req.addEventListener('abort', reject)\n      req.open(method, url)\n      if (method === 'POST') {\n        req.setRequestHeader('Content-Type', 'application/json')\n      }\n      req.send(JSON.stringify(data))\n    })\n  }\n  \n  constructor(params : {\n    host: string, \n    RPCFn?: RPCFunc\n  }) {\n    if (!params.host)\n      throw \"Please set the host parameter\"\n\n    this.host = params.host\n    this.RPCFn = params.RPCFn || null\n\n    this.bindApi(gets)\n  }\n\n  bindApi(gets : ApiGetsFunc) {\n    this.fetch = {}\n    const gets_closure = gets((url, data) => this.get.call(this, url, data))\n\n    Object.keys(gets_closure).forEach(key => {\n      this.fetch[key] = (...args) => {\n        return gets_closure[key].apply(null, args)\n      }\n    })\n  }\n\n  get(url: string, data?: TezJSON) {\n    return (this.RPCFn || TezBridgeNetwork.RPCFn)(this.host + url, data, 'GET')\n  }\n\n  post(url: string, data: TezJSON) {\n    return (this.RPCFn || TezBridgeNetwork.RPCFn)(this.host + url, data, 'POST')\n  }\n\n}\n\nexport default TezBridgeNetwork"]}